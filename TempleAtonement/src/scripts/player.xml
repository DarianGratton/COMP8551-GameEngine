<root>
    <update>

        <!-- If attacking, add to a timer and not allow new input -->
        <ifVar name="isAttacking" value="true" type="bool">
            <addVar name="attackTimer" value="deltaTime" type="double"/>
            <ifVarGreater name="attackTimer" value="0.15" type="double">
                <updateVar name="attackTimer" value="0.0" type="double"/>
                <updateVar name="isAttacking" value="false" type="bool" />
                <onEntity name="weaponEntity">
                    <setActive value="false"/>
                </onEntity>
            </ifVarGreater>
        </ifVar>

        <!-- attack -->
        <ifVar name="isAttacking" value="false" type="bool">
            <keyPress value="KEY_SPACE">
                <updateVar name="isAttacking" value="true" type="bool"/>
                <onEntity name="weaponEntity">
                    <setActive value="true"/>
                    <playAudio/>
                </onEntity>
                <!-- Check player direction to move weaponEntity -->
                <matchEntityPos name="weaponEntity"/>
                <ifVar name="playerDirection" value="0" type="int">
                    <!-- Up -->
                    <onEntity name="weaponEntity">
                        <moveEntity x="0.0" y="24.0" z="0.0" applyDt="false"/>
                        <changeSprite name="../TempleAtonement/texture/slash.png"/>
                    </onEntity>
                </ifVar>
                <ifVar name="playerDirection" value="1" type="int">
                    <!-- Right -->
                    <onEntity name="weaponEntity">
                        <moveEntity x="24.0" y="0.0" z="0.0" applyDt="false"/>
                        <changeSprite name="../TempleAtonement/texture/slash.png"/>
                    </onEntity>
                </ifVar>
                <ifVar name="playerDirection" value="2" type="int">
                    <!-- Down -->
                    <onEntity name="weaponEntity">
                        <moveEntity x="0.0" y="-24.0" z="0.0" applyDt="false"/>
                        <changeSprite name="../TempleAtonement/texture/slash.png"/>
                    </onEntity>
                </ifVar>
                <ifVar name="playerDirection" value="3" type="int">
                    <!-- Left -->
                    <onEntity name="weaponEntity">
                        <moveEntity x="-24.0" y="0.0" z="0.0" applyDt="false"/>
                        <changeSprite name="../TempleAtonement/texture/slash.png"/>
                    </onEntity>
                </ifVar>
            </keyPress>
        </ifVar>

        <!-- For audio check -->
        <updateVar name="checkMove" type="bool" value="false"/>

        <!-- movement -->
        <ifVar name="isAttacking" value="false" type="bool">
            <keyPress value="KEY_W">
                <changeSprite name="../TempleAtonement/texture/player_up.png"/>
                <moveEntity x="0.0" y="12.0" z="0.0" applyDt="true"/>
                <updateVar name="playerDirection" value="0" type="int"/>
                <ifVar name="isMoving" type="bool" value="false">
                    <flipBool name="isMoving"/>
                    <updateVar name="checkMove" type="bool" value="true"/>
                    <playAudio/>
                </ifVar>
            </keyPress>
            <keyPress value="KEY_S">
                <changeSprite name="../TempleAtonement/texture/player_down.png"/>
                <moveEntity x="0.0" y="-12.0" z="0.0" applyDt="true"/>
                <updateVar name="playerDirection" value="2" type="int"/>
                <ifVar name="isMoving" type="bool" value="false">
                    <flipBool name="isMoving"/>
                    <updateVar name="checkMove" type="bool" value="true"/>
                    <playAudio/>
                </ifVar>
            </keyPress>
            <keyPress value="KEY_A">
                <changeSprite name="../TempleAtonement/texture/player_left.png"/>
                <moveEntity x="-12.0" y="0.0" z="0.0" applyDt="true"/>
                <updateVar name="playerDirection" value="3" type="int"/>
                <ifVar name="isMoving" type="bool" value="false">
                    <flipBool name="isMoving"/>
                    <updateVar name="checkMove" type="bool" value="true"/>
                    <playAudio/>
                </ifVar>
            </keyPress>
            <keyPress value="KEY_D">
                <changeSprite name="../TempleAtonement/texture/player_right.png"/>
                <moveEntity x="12.0" y="0.0" z="0.0" applyDt="true"/>
                <updateVar name="playerDirection" value="1" type="int"/>
                <ifVar name="isMoving" type="bool" value="false">
                    <flipBool name="isMoving"/>
                    <updateVar name="checkMove" type="bool" value="true"/>
                    <playAudio/>
                </ifVar>
            </keyPress>
        </ifVar>

        <ifVar name="checkMove" type="bool" value="false">
            <updateVar name="isMoving" type="bool" value="false"/>
            <stopAudio/>
        </ifVar>

        <!-- interact -->
        <keyPress value="KEY_E">
            <onEntity name="interactEntity">
                <callFunction name="interacted"/>
            </onEntity>
        </keyPress>
        <updateVar name="interactEntity" type="entity" value=""/>
        
        <!-- If invincible, increment timer and maybe stop being invincible -->
        <ifVar name="isInvincible" type="bool" value="true">
            <addVar name="invinTimer" value="deltaTime" type="double"/>
            <ifVarGreater name="invinTimer" value="3.0" type="double">
                <updateVar name="invinTimer" value="0.0" type="double"/>
                <updateVar name="isInvincible" value="false" type="bool" />
                <updateVar name="blink" value="true" type="bool" />
            </ifVarGreater>
            <flipBool name="blink"/>
            <ifVar name="blink" type="bool" value="false">
                <ifVar name="playerDirection" value="0" type="int">
                    <!-- Up -->
                    <changeSprite name="../TempleAtonement/texture/player_up.png"/>
                </ifVar>
                <ifVar name="playerDirection" value="1" type="int">
                    <!-- Right -->
                    <changeSprite name="../TempleAtonement/texture/player_right.png"/>
                </ifVar>
                <ifVar name="playerDirection" value="2" type="int">
                    <!-- Down -->
                    <changeSprite name="../TempleAtonement/texture/player_down.png"/>
                </ifVar>
                <ifVar name="playerDirection" value="3" type="int">
                    <!-- Left -->
                    <changeSprite name="../TempleAtonement/texture/player_left.png"/>
                </ifVar>
            </ifVar>
            <ifVar name="blink" type="bool" value="true">
                <changeSprite name="../TempleAtonement/texture/transparent.png"/>
            </ifVar>
        </ifVar>
    </update>

    <variables>
        <bool name="isAttacking" value="false"/>
        <double name="attackTimer" value="0.0"/>
        <int name="playerDirection" value="2"/> <!-- 0 - up, 1 - right, 2 - down, 3 - left -->
        <entity name="weaponEntity" value="weaponEntity"/>
        <globalInt name="health" value="5"/>
        <!-- <entity name="scoreEntity" value="score"/> -->
        <entity name="interactEntity" value=""/> <!-- No entity to start -->
        <double name="invinTimer" value="0.0"/>
        <bool name="isInvincible" value="false"/>
        <bool name="blink" value="false"/>
        <globalInt name="points" value="0"/>
        <entity name="tempEntity" value=""/>
        <bool name="isMoving" value="false"/>
        <bool name="checkMove" value="false"/>
        
        <globalFloat name="newPlayerX" value="160"/>
        <globalFloat name="newPlayerY" value="864"/>
        <float name="localNewPlayerX" value="160"/>
        <float name="localNewPlayerY" value="864"/>

        <entity name="scoreFirstDigitEntity" value="scoreFirstDigitEntity"/>
        <entity name="scoreSecondDigitEntity" value="scoreSecondDigitEntity"/>
        <entity name="scoreThirdDigitEntity" value="scoreThirdDigitEntity"/>
        <entity name="scoreFourthDigitEntity" value="scoreFourthDigitEntity"/>

        <int name="scoreFirstDigit" value="0"/>
        <int name="scoreSecondDigit" value="0"/>
        <int name="scoreThirdDigit" value="0"/>
        <int name="scoreFourthDigit" value="0"/>
    </variables>

    <addPoints>
        <addGlobalVar name="points" value="1" type="int"/>
    </addPoints>
    <updatePointDisplay>
        <setEqual name="scoreFirstDigit" type="int" value="points" isGlobal="true"/>
        <modVar name="scoreFirstDigit" type="int" value="10"/>

        <setEqual name="scoreSecondDigit" type="int" value="points" isGlobal="true"/>
        <divideVar name="scoreSecondDigit" type="int" value="10"/>
        <modVar name="scoreSecondDigit" type="int" value="10"/>

        <setEqual name="scoreThirdDigit" type="int" value="points" isGlobal="true"/>
        <divideVar name="scoreThirdDigit" type="int" value="100"/>
        <modVar name="scoreThirdDigit" type="int" value="10"/>

        <setEqual name="scoreFourthDigit" type="int" value="points" isGlobal="true"/>
        <divideVar name="scoreFourthDigit" type="int" value="1000"/>
        <modVar name="scoreFourthDigit" type="int" value="10"/>

        <onEntity name="scoreFirstDigitEntity">
            <ifVar name="scoreFirstDigit" value="0" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/0.png"/>
            </ifVar>
            <ifVar name="scoreFirstDigit" value="1" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/1.png"/>
            </ifVar>
            <ifVar name="scoreFirstDigit" value="2" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/2.png"/>
            </ifVar>
            <ifVar name="scoreFirstDigit" value="3" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/3.png"/>
            </ifVar>
            <ifVar name="scoreFirstDigit" value="4" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/4.png"/>
            </ifVar>
            <ifVar name="scoreFirstDigit" value="5" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/5.png"/>
            </ifVar>
            <ifVar name="scoreFirstDigit" value="6" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/6.png"/>
            </ifVar>
            <ifVar name="scoreFirstDigit" value="7" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/7.png"/>
            </ifVar>
            <ifVar name="scoreFirstDigit" value="8" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/8.png"/>
            </ifVar>
            <ifVar name="scoreFirstDigit" value="9" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/9.png"/>
            </ifVar>
        </onEntity>

        <onEntity name="scoreSecondDigitEntity">
            <ifVar name="scoreSecondDigit" value="0" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/0.png"/>
            </ifVar>
            <ifVar name="scoreSecondDigit" value="1" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/1.png"/>
            </ifVar>
            <ifVar name="scoreSecondDigit" value="2" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/2.png"/>
            </ifVar>
            <ifVar name="scoreSecondDigit" value="3" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/3.png"/>
            </ifVar>
            <ifVar name="scoreSecondDigit" value="4" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/4.png"/>
            </ifVar>
            <ifVar name="scoreSecondDigit" value="5" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/5.png"/>
            </ifVar>
            <ifVar name="scoreSecondDigit" value="6" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/6.png"/>
            </ifVar>
            <ifVar name="scoreSecondDigit" value="7" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/7.png"/>
            </ifVar>
            <ifVar name="scoreSecondDigit" value="8" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/8.png"/>
            </ifVar>
            <ifVar name="scoreSecondDigit" value="9" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/9.png"/>
            </ifVar>
        </onEntity>

        <onEntity name="scoreThirdDigitEntity">
            <ifVar name="scoreThirdDigit" value="0" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/0.png"/>
            </ifVar>
            <ifVar name="scoreThirdDigit" value="1" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/1.png"/>
            </ifVar>
            <ifVar name="scoreThirdDigit" value="2" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/2.png"/>
            </ifVar>
            <ifVar name="scoreThirdDigit" value="3" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/3.png"/>
            </ifVar>
            <ifVar name="scoreThirdDigit" value="4" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/4.png"/>
            </ifVar>
            <ifVar name="scoreThirdDigit" value="5" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/5.png"/>
            </ifVar>
            <ifVar name="scoreThirdDigit" value="6" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/6.png"/>
            </ifVar>
            <ifVar name="scoreThirdDigit" value="7" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/7.png"/>
            </ifVar>
            <ifVar name="scoreThirdDigit" value="8" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/8.png"/>
            </ifVar>
            <ifVar name="scoreThirdDigit" value="9" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/9.png"/>
            </ifVar>
        </onEntity>
        
        <onEntity name="scoreFourthDigitEntity">
            <ifVar name="scoreFourthDigit" value="0" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/0.png"/>
            </ifVar>
            <ifVar name="scoreFourthDigit" value="1" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/1.png"/>
            </ifVar>
            <ifVar name="scoreFourthDigit" value="2" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/2.png"/>
            </ifVar>
            <ifVar name="scoreFourthDigit" value="3" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/3.png"/>
            </ifVar>
            <ifVar name="scoreFourthDigit" value="4" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/4.png"/>
            </ifVar>
            <ifVar name="scoreFourthDigit" value="5" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/5.png"/>
            </ifVar>
            <ifVar name="scoreFourthDigit" value="6" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/6.png"/>
            </ifVar>
            <ifVar name="scoreFourthDigit" value="7" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/7.png"/>
            </ifVar>
            <ifVar name="scoreFourthDigit" value="8" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/8.png"/>
            </ifVar>
            <ifVar name="scoreFourthDigit" value="9" type="int">
                <changeSprite name="../TempleAtonement/texture/Numbers/9.png"/>
            </ifVar>
        </onEntity>

    </updatePointDisplay>
    <updatePos>
        <setEqual name="localNewPlayerX" type="float" value="newPlayerX" isGlobal="true"/>
        <setEqual name="localNewPlayerY" type="float" value="newPlayerY" isGlobal="true"/>
        <multiVar name="localNewPlayerY" type="float" value="-1"/>
        <setPos x="localNewPlayerX" y="localNewPlayerY"/>
    </updatePos>
    <start>
        <callFunction name="updatePointDisplay"/>
        <callFunction name="updatePos"/>
    </start>
    <onCollision>
        <ifVar name="collisionObject-tag" value="Enemy" type="string">
            <ifVar name="isInvincible" type="bool" value="false">
                <addGlobalVar name="health" value="-1" type="int"/>
                <ifGlobalVar name="health" value="0" type="int">
                    <log value="Health is at 0!"/>
                    <loadScene name="gameoverScene"/>
                </ifGlobalVar>
                <updateVar name="isInvincible" value="true" type="bool"/>
            </ifVar>
        </ifVar>
        <ifVar name="collisionObject-tag" value="Coin" type="string">
            <updateVar name="tempEntity" value="collisionObject-name" type="entity"/>
			<onEntity name="tempEntity">
                <playAudio/>
                <setActive value="false"/>
            </onEntity>
            <callFunction name="addPoints"/>
            <callFunction name="addPoints"/>
            <callFunction name="addPoints"/>
            <callFunction name="addPoints"/>
            <callFunction name="addPoints"/>
            <callFunction name="updatePointDisplay"/>
        </ifVar>
        <ifVar name="collisionObject-tag" value="Interactable" type="string">
            <updateVar name="interactEntity" value="collisionObject-name" type="entity"/>
        </ifVar>
    </onCollision>
</root>

<!-- 
Reserved:
Variable Names:
    collisionObject-tag -> the value of the tag component on the other object
keyPress Input values:
    KEY_W - w
    KEY_S - s
    KEY_A - a
    KEY_D - d
    KEY_SPACE - space
Reserved other value names:
    deltaTime - the deltaTime during the update
    collisionObject-name -> the value of the name component of the other object

New Commands:
onEntity name="nameOfEntityVariable" :
    perform the sub-section of commands in the context of the entity stored in the variable specified
entity name="nameOfVariable" value="nameOfEntityToBeStored" :
    variable type for storing entities, entities are found by name
callMethod name="methodName" :
    runs the code within the node with the name matching the name attribute, custom methods should be siblings to update, start, variables, onCollision, etc.
changeSprite name="texturePathName.png" :
    changes the texture of the texture component of this entity to the one specified
ifVarGreater name="variableName" value="someNumber" :
    same as if (variableName > someNumber) {
keyPress value="keyCode" :
    if statement but checks if a key is being pressed
matchEntityPos name="nameOfEntityVariable"
    set the entity's pos to the current entity's pos
-->